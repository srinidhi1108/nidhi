"""drive state fixing_gpt_position

Revision ID: 4fba6d4f131c
Revises: 41ac2aeac093
Create Date: 2019-03-27 11:56:20.967143

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '4fba6d4f131c'
down_revision = '41ac2aeac093'
branch_labels = None
depends_on = None


old_states = sa.Enum('PENDING', 'PREPARATION', 'PARTITIONING',
                     'DISABLING_AGENT', 'P2V', 'READY', 'DELETING', 'ERROR',
                     'DISABLING_REPAIR_SCREEN')
new_states = sa.Enum('PENDING', 'PREPARATION', 'PARTITIONING',
                     'DISABLING_AGENT', 'P2V', 'READY', 'DELETING', 'ERROR',
                     'DISABLING_REPAIR_SCREEN', 'FIXING_GPT_POSITION')

ft = sa.sql.table('drive', sa.sql.column('state', new_states))


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('drive', 'state',
                    existing_type=new_states, nullable=True)
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.execute(ft.update().where(ft.c.state.in_(
        ['FIXING_GPT_POSITION'])).values(state='PARTITIONING'))
    op.alter_column('drive', 'state',
                    existing_type=old_states, nullable=True)
    # ### end Alembic commands ###
