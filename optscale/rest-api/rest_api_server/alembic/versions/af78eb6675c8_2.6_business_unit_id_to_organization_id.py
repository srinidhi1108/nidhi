""""2.6 business_unit_id to organization_id"

Revision ID: af78eb6675c8
Revises: 2684a850a5fe
Create Date: 2020-09-07 14:46:59.188711

"""
from alembic import op
import sqlalchemy as sa

# revision identifiers, used by Alembic.
revision = 'af78eb6675c8'
down_revision = '2684a850a5fe'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    # drop foreign keys
    op.drop_constraint('cc_organization_fk', 'cloudaccount',
                       type_='foreignkey')
    op.drop_constraint('employee_organization_fk', 'employee',
                       type_='foreignkey')
    op.drop_constraint('project_organization_fk', 'project', type_='foreignkey')
    op.drop_constraint('rule_organization_fk', 'rule', type_='foreignkey')
    # drop unique constraints
    op.drop_constraint('uc_account_type_bu_id_del_at', 'cloudaccount',
                       type_='unique')
    op.drop_constraint('uc_bu_name_del_at', 'cloudaccount', type_='unique')
    op.drop_constraint('uc_employee_bu_auth_user', 'employee', type_='unique')
    op.drop_constraint('uc_name_del_at_bu_id', 'rule', type_='unique')
    # rename columns
    op.alter_column('cloudaccount', 'business_unit_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='organization_id')
    op.alter_column('employee', 'business_unit_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='organization_id')
    op.alter_column('project', 'business_unit_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='organization_id')
    op.alter_column('resource_cache', 'business_unit_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='organization_id')
    op.alter_column('resource_cache_request', 'business_unit_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='organization_id')
    op.alter_column('rule', 'business_unit_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='organization_id')
    # create unique constraints
    op.create_unique_constraint(
        "uc_account_type_org_id_del_at", 'cloudaccount',
        ['account_id', 'type', 'organization_id', 'deleted_at'])
    op.create_unique_constraint(
        "uc_org_name_del_at", 'cloudaccount',
        ['organization_id', 'name', 'deleted_at'])
    op.create_unique_constraint(
        "uc_employee_org_auth_user", 'employee',
        ['organization_id', 'auth_user_id', 'deleted_at'])
    op.create_unique_constraint(
        "uc_name_del_at_org_id", 'rule',
        ['name', 'deleted_at', 'organization_id'])
    # create foreign keys
    op.create_foreign_key('ca_organization_fk', 'cloudaccount',
                          'organization', ['organization_id'], ['id'])
    op.create_foreign_key('employee_organization_fk', 'employee',
                          'organization', ['organization_id'], ['id'])
    op.create_foreign_key('project_organization_fk', 'project',
                          'organization', ['organization_id'], ['id'])
    op.create_foreign_key('rule_organization_fk', 'rule',
                          'organization', ['organization_id'], ['id'])
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    # drop foreign keys
    op.drop_constraint('ca_organization_fk', 'cloudaccount',
                       type_='foreignkey')
    op.drop_constraint('employee_organization_fk', 'employee',
                       type_='foreignkey')
    op.drop_constraint('project_organization_fk', 'project',
                       type_='foreignkey')
    op.drop_constraint('rule_organization_fk', 'rule', type_='foreignkey')
    # drop unique constraints
    op.drop_constraint('uc_account_type_org_id_del_at', 'cloudaccount',
                       type_='unique')
    op.drop_constraint('uc_org_name_del_at', 'cloudaccount', type_='unique')
    op.drop_constraint('uc_employee_org_auth_user', 'employee', type_='unique')
    op.drop_constraint('uc_name_del_at_org_id', 'rule', type_='unique')
    # rename columns
    op.alter_column('cloudaccount', 'organization_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='business_unit_id')
    op.alter_column('employee', 'organization_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='business_unit_id')
    op.alter_column('project', 'organization_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='business_unit_id')
    op.alter_column('resource_cache', 'organization_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='business_unit_id')
    op.alter_column('resource_cache_request', 'organization_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='business_unit_id')
    op.alter_column('rule', 'organization_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='business_unit_id')
    # create unique constraints
    op.create_unique_constraint(
        'uc_account_type_bu_id_del_at', 'cloudaccount',
        ['account_id', 'type', 'business_unit_id', 'deleted_at'])
    op.create_unique_constraint(
        'uc_bu_name_del_at', 'cloudaccount',
        ['business_unit_id', 'name', 'deleted_at'])
    op.create_unique_constraint(
        'uc_employee_bu_auth_user', 'employee',
        ['business_unit_id', 'auth_user_id', 'deleted_at'])
    op.create_unique_constraint(
        'uc_name_del_at_bu_id', 'rule',
        ['name', 'deleted_at', 'business_unit_id'])
    # create foreign keys
    op.create_foreign_key('cc_organization_fk', 'cloudaccount',
                          'organization', ['business_unit_id'], ['id'])
    op.create_foreign_key('employee_organization_fk', 'employee',
                          'organization', ['business_unit_id'], ['id'])
    op.create_foreign_key('project_organization_fk', 'project',
                          'organization', ['business_unit_id'], ['id'])
    op.create_foreign_key('rule_organization_fk', 'rule',
                          'organization', ['business_unit_id'], ['id'])
    # ### end Alembic commands ###
