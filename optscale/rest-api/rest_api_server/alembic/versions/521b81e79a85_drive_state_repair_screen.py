""""drive_state_repair_screen"

Revision ID: 521b81e79a85
Revises: 772dec00afbd
Create Date: 2019-01-14 15:39:45.430131

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision = '521b81e79a85'
down_revision = '772dec00afbd'
branch_labels = None
depends_on = None

old_states = sa.Enum('PENDING', 'PREPARATION', 'PARTITIONING',
                     'DISABLING_AGENT', 'P2V', 'READY', 'DELETING', 'ERROR')
new_states = sa.Enum('PENDING', 'PREPARATION', 'PARTITIONING',
                     'DISABLING_AGENT', 'P2V', 'READY', 'DELETING', 'ERROR',
                     'DISABLING_REPAIR_SCREEN')

ft = sa.sql.table('drive', sa.sql.column('state', new_states))


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('drive', 'state',
                    existing_type=new_states, nullable=True)
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.execute(ft.update().where(ft.c.state.in_(
        ['DISABLING_REPAIR_SCREEN'])).values(state='P2V'))
    op.alter_column('drive', 'state',
                    existing_type=old_states, nullable=True)
    # ### end Alembic commands ###
