""""2.7 cloud_credentials_id to cloud_account_id"

Revision ID: 3a1c4cf5ad2e
Revises: af78eb6675c8
Create Date: 2020-09-07 23:15:31.616368

"""
from alembic import op
import sqlalchemy as sa

# revision identifiers, used by Alembic.
revision = '3a1c4cf5ad2e'
down_revision = 'af78eb6675c8'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint('reportimport_ca_fk', 'reportimport', type_='foreignkey')
    op.drop_constraint('resource_ca_fk', 'resource', type_='foreignkey')
    op.drop_constraint('uc_res_cred_del_at', 'resource', type_='unique')
    op.alter_column('cloudaccount', 'cloud_credentials',
                    existing_type=sa.TEXT(), nullable=False,
                    new_column_name='config')
    op.alter_column('reportimport', 'cloud_credentials_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='cloud_account_id')
    op.alter_column('resource', 'cloud_credentials_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='cloud_account_id')
    op.alter_column('resource_cache', 'cloud_credential_id',
                    existing_type=sa.String(36), nullable=True,
                    new_column_name='cloud_account_id')
    op.alter_column('resource_cache', 'cloud_credential_name',
                    existing_type=sa.String(length=256), nullable=True,
                    new_column_name='cloud_account_name')
    op.create_unique_constraint(
        'uc_res_acc_del_at', 'resource',
        ['cloud_resource_id', 'cloud_account_id', 'deleted_at'])
    op.create_foreign_key('reportimport_ca_fk', 'reportimport', 'cloudaccount',
                          ['cloud_account_id'], ['id'])
    op.create_foreign_key('resource_ca_fk', 'resource', 'cloudaccount',
                          ['cloud_account_id'], ['id'])
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint('reportimport_ca_fk', 'reportimport', type_='foreignkey')
    op.drop_constraint('resource_ca_fk', 'resource', type_='foreignkey')
    op.drop_constraint('uc_res_acc_del_at', 'resource', type_='unique')
    op.alter_column('cloudaccount', 'config',
                    existing_type=sa.TEXT(), nullable=False,
                    new_column_name='cloud_credentials')
    op.alter_column('reportimport', 'cloud_account_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='cloud_credentials_id')
    op.alter_column('resource', 'cloud_account_id',
                    existing_type=sa.String(36), nullable=False,
                    new_column_name='cloud_credentials_id')
    op.alter_column('resource_cache', 'cloud_account_id',
                    existing_type=sa.String(36), nullable=True,
                    new_column_name='cloud_credential_id')
    op.alter_column('resource_cache', 'cloud_account_name',
                    existing_type=sa.String(length=256), nullable=True,
                    new_column_name='cloud_credential_name')
    op.create_unique_constraint(
        'uc_res_cred_del_at', 'resource',
        ['cloud_resource_id', 'cloud_credentials_id', 'deleted_at'])
    op.create_foreign_key('reportimport_ca_fk', 'reportimport', 'cloudaccount',
                          ['cloud_credentials_id'], ['id'])
    op.create_foreign_key('resource_ca_fk', 'resource', 'cloudaccount',
                          ['cloud_credentials_id'], ['id'])
    # ### end Alembic commands ###
